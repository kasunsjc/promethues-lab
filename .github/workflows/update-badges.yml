name: ðŸ·ï¸ Update Status Badges

on:
  workflow_run:
    workflows: 
      - "ðŸ”­ Validate Prometheus Monitoring Stack"
      - "ðŸš€ Quick Validation"
      - "ðŸš¨ Alert System Test"
      - "ðŸ”¥ Load Test Validation"
    types:
      - completed

jobs:
  update-badges:
    name: ðŸ·ï¸ Update README Badges
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: ðŸ“¥ Checkout
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ðŸ·ï¸ Update validation badge
      run: |
        echo "ðŸ·ï¸ Validation workflow completed"
        # Note: Badges will be automatically updated by GitHub based on workflow status
        # This job serves as a placeholder for any badge-related automation
        
    - name: ðŸ“Š Create status summary
      run: |
        echo "ðŸ“Š Creating status summary..."
        
        echo "# ðŸ”­ Monitoring Stack Status" > STATUS.md
        echo "" >> STATUS.md
        echo "Last updated: $(date)" >> STATUS.md
        echo "" >> STATUS.md
        echo "## ðŸš€ Workflow Status" >> STATUS.md
        echo "" >> STATUS.md
        echo "- Configuration Validation: ![Validation](https://github.com/${{ github.repository }}/actions/workflows/quick-validate.yml/badge.svg)" >> STATUS.md
        echo "- Full Stack Test: ![Stack Test](https://github.com/${{ github.repository }}/actions/workflows/validate-demos.yml/badge.svg)" >> STATUS.md
        echo "- Alert System Test: ![Alert Test](https://github.com/${{ github.repository }}/actions/workflows/test-alerts.yml/badge.svg)" >> STATUS.md
        echo "- Load Test Validation: ![Load Test](https://github.com/${{ github.repository }}/actions/workflows/load-test-validation.yml/badge.svg)" >> STATUS.md
        echo "" >> STATUS.md
        echo "## ðŸ“Š Components" >> STATUS.md
        echo "" >> STATUS.md
        echo "- âœ… Prometheus" >> STATUS.md
        echo "- âœ… Alertmanager" >> STATUS.md
        echo "- âœ… Grafana" >> STATUS.md
        echo "- âœ… MySQL + Exporter" >> STATUS.md
        echo "- âœ… Nginx + Exporter" >> STATUS.md
        echo "- âœ… Node Exporter" >> STATUS.md
        echo "- âœ… k6 Load Testing" >> STATUS.md
        echo "- âœ… InfluxDB" >> STATUS.md
        
        cat STATUS.md
